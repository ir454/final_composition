<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Möbius Sculpture</title>
<style>
  body { margin:0; overflow:hidden; background:#111; }
  canvas { display:block; }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
/* ===============================
   THREE.JS SETUP
=============================== */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 100);
camera.position.set(0,5,20);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* LIGHT */
scene.add(new THREE.AmbientLight(0xffffff,0.5));

/* ===============================
   CREATE MÖBIUS STRIPS
=============================== */
const sculpture = new THREE.Group();
scene.add(sculpture);

const shapes = [];
const shapeCount = 15;
const spread = 10;

function createMobius(radius,tube,p,q){
  const geom = new THREE.MobiusStripGeometry(radius,tube,8,30,p,q);
  const mat = new THREE.MeshStandardMaterial({color:0x00ffcc, wireframe:true});
  return new THREE.Mesh(geom, mat);
}

for(let i=0;i<shapeCount;i++){
  const radius = 0.5 + Math.random()*1.5;
  const tube = 0.1 + Math.random()*0.3;
  const p = Math.random()*2*Math.PI;
  const q = 1 + Math.floor(Math.random()*2);

  const mesh = createMobius(radius,tube,p,q);
  mesh.position.set((Math.random()-0.5)*spread,(Math.random()-0.5)*spread,(Math.random()-0.5)*spread);
  mesh.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, Math.random()*Math.PI);
  sculpture.add(mesh);

  shapes.push({mesh, phase: Math.random()*Math.PI*2});
}

/* ===============================
   WEB AUDIO
=============================== */
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
const Cminor = [261.63,311.13,392,466,523];
let step=0;

function playNote(freq,shape){
  const osc = audioCtx.createOscillator();
  osc.type='sine';
  osc.frequency.value=freq;

  const gain = audioCtx.createGain();
  gain.gain.value = 0.05;

  const panner = audioCtx.createPanner();
  panner.panningModel='HRTF';
  panner.positionX.value = shape.mesh.position.x;
  panner.positionY.value = shape.mesh.position.y;
  panner.positionZ.value = shape.mesh.position.z;

  osc.connect(panner).connect(gain).connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime+0.2);
}

/* ===============================
   ANIMATE
=============================== */
function animate(){
  requestAnimationFrame(animate);
  const t = performance.now()*0.001;

  shapes.forEach((s,i)=>{
    s.mesh.rotation.x += 0.01 + 0.01*Math.sin(t+s.phase);
    s.mesh.rotation.y += 0.01 + 0.01*Math.cos(t+s.phase);
  });

  camera.position.x = Math.sin(t*0.5)*15;
  camera.position.y = 5 + Math.sin(t*0.3)*5;
  camera.position.z = Math.cos(t*0.5)*15;
  camera.lookAt(0,0,0);

  renderer.render(scene,camera);

  // Sequencer
  if(Math.floor(t*4) > step){
    shapes.forEach((s,i)=>{
      if((step+i)%5===0){
        playNote(Cminor[i%Cminor.length], s);
      }
    });
    step = Math.floor(t*4);
  }
}
animate();

/* RESIZE */
window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

/* START AUDIO ON CLICK */
document.body.addEventListener('click',()=>{ if(audioCtx.state==='suspended') audioCtx.resume(); });
</script>
</body>
</html>
